<h1>
  Report<br/>
  <small><%= @supplier %></small>
</h1>

<div class="text-center my-4">
<% Supplier.order(:name).each do |supplier| %>  
  <%= link_to supplier, reports_path(supplier_id: supplier.id), class: 'btn btn-outline-primary btn-sm' %>
<% end %>
</div>

<% if @supplier %>  
  <% contract_hash = @supplier.contracts.inject({}) {|res, c| res[c.cer_code_id] = c.price; res} %>  
<% end %>
<% current_organization_id = 0 %>

<table class="table table-sm ms-4">
  <thead>
    <tr>
      <th>UL</th>
      <th>FORMULARIO</th>
      <th>DATA</th>
      <th>CER</th>
      <th class="number">TOTALE KG.</th>
      <th class="number">&euro; / Kg.</th>
      <th class="number">TOTALE</th>
    </tr>
  </thead>
  <tbody>
    <% @pickings.each do |picking| %>
      <% picking.picking_documents.each do |document| %>  
        <% cer_code = document.disposal_type.cer_code %>  
        <tr class="table-info">
          <th>
            <% if (current_organization_id != (current_organization_id = picking.organization_id)) %>
              <%= picking.organization.code %>
            <% end %>
          </th>
          <td><%= document %></td>
          <td><%= picking.date %></td>
          <td><%= cer_code %></td>
          <td class="number"><%= document.kgs %> <small>Kg.</small></td>
          <td class="number bg-warning"><%= contract_hash ? contract_hash[cer_code.id].to_f : 0 %> &euro;</td>
          <td class="number">
            <%= document.kgs * (contract_hash ? contract_hash[cer_code.id].to_f : 0) %>&euro;
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
